<!DOCTYPE html>
<html lang="en" style="height: 100%;">
<head>
  <title>Interactive Map</title>
  {% load static %}
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="{% static 'css/Heading.css' %}">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    :root{
      --bg-page:#f6f8fc;
      --bg-card:#ffffff;
      --primary:#5b61f6;
      --primary-2:#4c54ea;
      --primary-soft:rgba(91,97,246,.14);
      --border:#e5e9f4;
      --text:#0f172a;
      --muted:#667085;
      --radius-xl:18px;
      --shadow-sm:0 6px 20px rgba(15,23,42,.06);
      --shadow-md:0 12px 36px rgba(15,23,42,.10);
      --ctrl-h:48px;
      --t:.2s ease;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg-page);color:var(--text);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}

    /* Hero */
    .hero{
      background:
        radial-gradient(80% 60% at 10% -20%, #c7d2fe 0%, transparent 60%),
        radial-gradient(80% 60% at 100% -10%, #fde68a 10%, transparent 60%),
        linear-gradient(180deg,#fff, #fafbff 90%, transparent 100%);
      border-bottom:1px solid var(--border);
    }
    .hero-inner{max-width:1200px;margin:0 auto;padding:28px 24px 10px;text-align:center;}
    .title{margin:8px 0 6px;font-size:clamp(24px,3.2vw,34px);font-weight:700;letter-spacing:.2px;}
    .subtitle{margin:0 auto 18px;max-width:800px;color:var(--muted)}

    .page{max-width:1200px;margin:0 auto;padding:16px 24px 60px}

    /* Tabs */
.tabs{display:block}

/* scrollable chip row ONLY */
.tab-strip{
  overflow-x:auto;
  white-space:nowrap;
  padding-bottom:6px;
  border-bottom:1px solid #dfe3ef;
  margin-bottom:8px;
}
.tab-strip > input[type="radio"]{display:none}

.tab-strip > label{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:10px 14px;
  margin:0 8px 4px 0;
  border-radius:999px;
  background:#fff;
  border:1px solid var(--border);
  color:#3b4353;
  cursor:pointer;
  transition:all var(--t);
}
.tab-strip > label:hover{
  box-shadow:0 6px 16px rgba(91,97,246,.18);
  color:var(--primary);
}

/* active tab chip */
#tab1:checked + label,
#tab2:checked + label,
#tab3:checked + label,
#tab4:checked + label,
#tab5:checked + label,
#tab6:checked + label,
#tab7:checked + label,
#tab8:checked + label,
#tab9:checked + label,
#tab10:checked + label,
#tab11:checked + label,
#tab12:checked + label,
#tab13:checked + label{
  color:var(--primary);
  border-color:#dfe4ff;
  box-shadow:0 8px 18px rgba(91,97,246,.28);
  transform:translateY(-1px);
}


    /* active tab chip (uses adjacent-sibling selector) */
    #tab1:checked + label,
    #tab2:checked + label,
    #tab3:checked + label,
    #tab4:checked + label,
    #tab5:checked + label,
    #tab6:checked + label,
    #tab7:checked + label,
    #tab8:checked + label,
    #tab9:checked + label,
    #tab10:checked + label,
    #tab11:checked + label,
    #tab12:checked + label,
    #tab13:checked + label{
      color:var(--primary);
      border-color:#dfe4ff;
      box-shadow:0 8px 18px rgba(91,97,246,.28);
      transform:translateY(-1px);
    }

    /* Sections block (sibling of the radios) */
.sections{margin-top:16px}
.sections section{display:none}

/* show the matching section when a tab is checked (uses :has) */
.tabs:has(#tab1:checked)  .sections #content1,
.tabs:has(#tab2:checked)  .sections #content2,
.tabs:has(#tab3:checked)  .sections #content3,
.tabs:has(#tab4:checked)  .sections #content4,
.tabs:has(#tab5:checked)  .sections #content5,
.tabs:has(#tab6:checked)  .sections #content6,
.tabs:has(#tab7:checked)  .sections #content7,
.tabs:has(#tab8:checked)  .sections #content8,
.tabs:has(#tab9:checked)  .sections #content9,
.tabs:has(#tab10:checked) .sections #content10,
.tabs:has(#tab11:checked) .sections #content11,
.tabs:has(#tab12:checked) .sections #content12,
.tabs:has(#tab13:checked) .sections #content13{
  display:block;
}


    /* Card & form */
    .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow-sm);padding:18px 20px}
    .station-title{margin:2px 0 10px;font-weight:700}

    .form-grid{
      display:grid;gap:14px;
      grid-template-columns:repeat(3,minmax(220px,1fr));
      align-items:start;
    }

    .field{display:grid;grid-template-rows:auto var(--ctrl-h);gap:6px;min-width:0}
    .label{font-size:.78rem;text-transform:uppercase;letter-spacing:.06em;color:var(--muted)}
    .control{
      height:var(--ctrl-h);width:100%;padding:10px 12px;border-radius:12px;
      background:#fbfcff;border:1px solid #dfe4f3;color:var(--text);font-size:.95rem;outline:none;
      transition:border var(--t), box-shadow var(--t), background var(--t);
    }
    .control:focus{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-soft);background:#fff}
    select.control{appearance:none;background-image:linear-gradient(45deg,transparent 50%, #98a2b3 50%),linear-gradient(135deg,#98a2b3 50%,transparent 50%),linear-gradient(to right,#dfe4f3,#dfe4f3);background-position:calc(100% - 18px) 18px, calc(100% - 12px) 18px, calc(100% - 2.4rem) 0.6rem;background-size:6px 6px,6px 6px,1px 70%;background-repeat:no-repeat}

    .quick-row{grid-column:1/-1;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #dfe4f3;background:#fff;color:#3b4353;font-size:.85rem;cursor:pointer;transition:all var(--t)}
    .chip:hover{border-color:#cfd6ff;background:var(--primary-soft);color:var(--primary)}

    .messages{grid-column:1/-1;display:flex;flex-direction:column;gap:10px}
    .alert{display:flex;gap:10px;align-items:flex-start;padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#f9fafb;color:#374151;box-shadow:0 1px 0 #f1f5f9 inset}
    .alert.info{background:#eef2ff;border-color:#c7d2fe;color:#1e3a8a}
    .alert.error{background:#fef2f2;border-color:#fecaca;color:#991b1b}
    .alert:empty{display:none}

    .actions{grid-column:1/-1;display:flex;gap:10px;justify-content:flex-end}
    .btn{padding:10px 18px;border-radius:999px;border:0;cursor:pointer;font-weight:600;font-size:.92rem;transition:transform var(--t), box-shadow var(--t), background var(--t), color var(--t)}
    .btn-primary{background:var(--primary);color:#fff;box-shadow:0 10px 20px rgba(91,97,246,.25)}
    .btn-primary:hover{background:var(--primary-2);transform:translateY(-1px);box-shadow:0 14px 28px rgba(91,97,246,.32)}
    .btn-ghost{background:#fff;color:var(--primary);border:1px solid #cfd6ff}
    .btn-ghost:hover{background:var(--primary-soft);border-color:var(--primary)}

    .graph-card{margin-top:16px;background:#fff;border:1px solid var(--border);border-radius:var(--radius-xl);box-shadow:var(--shadow-md);overflow:hidden}
    .graph-frame{display:block;width:100%;min-height:720px;border:0}
    .graph-loading{padding:16px 18px;color:var(--muted)}

    @media (max-width: 980px){
      .form-grid{grid-template-columns:minmax(0,1fr)}
      .actions{justify-content:flex-start}
    }
  </style>
</head>

<body>
  {% include "HTML/navbar.html" %}

  <header class="hero">
    <div class="hero-inner">
      <h1 class="title">Missouri River Gauge Dashboard</h1>
      <p class="subtitle">Pick a station, choose a metric, and visualize the data across any date range. Quick ranges are one tap.</p>
    </div>
  </header>

<main class="page">
  <div class="tabs">
    <div class="tab-strip">
      <input id="tab1"  type="radio" name="tabs" checked><label for="tab1">Hazen</label>
      <input id="tab2"  type="radio" name="tabs"><label for="tab2">Stanton</label>
      <input id="tab3"  type="radio" name="tabs"><label for="tab3">Washburn</label>
      <input id="tab4"  type="radio" name="tabs"><label for="tab4">Price</label>
      <input id="tab5"  type="radio" name="tabs"><label for="tab5">Bismarck</label>
      <input id="tab6"  type="radio" name="tabs"><label for="tab6">Schmidt</label>
      <input id="tab7"  type="radio" name="tabs"><label for="tab7">Judson</label>
      <input id="tab8"  type="radio" name="tabs"><label for="tab8">Mandan</label>
      <input id="tab9"  type="radio" name="tabs"><label for="tab9">Breien</label>
      <input id="tab10" type="radio" name="tabs"><label for="tab10">Wakpala</label>
      <input id="tab11" type="radio" name="tabs"><label for="tab11">Little Eagle</label>
      <input id="tab12" type="radio" name="tabs"><label for="tab12">Cash</label>
      <input id="tab13" type="radio" name="tabs"><label for="tab13">Whitehorse</label>
    </div>

      <!-- Sections are wrapped in a sibling container so the ~ selector can target inside it -->
      <div class="sections">
        {% comment %} ---------- ONE SECTION TEMPLATE (repeat for all stations) ---------- {% endcomment %}

        <!-- Hazen -->
        <section id="content1">
          <div class="card">
            <h3 class="station-title">Hazen, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}

              <div class="field">
                <label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>

              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Hazen ND">

              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-ghost" type="button" data-current>Current Data</button>
              </div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Choose a range and press <b>Submit</b>.</div></div>
        </section>

        <!-- Stanton -->
        <section id="content2">
          <div class="card">
            <h3 class="station-title">Stanton, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Stanton ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-ghost" type="button" data-current>Current Data</button>
              </div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Washburn -->
        <section id="content3">
          <div class="card">
            <h3 class="station-title">Washburn, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Washburn ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-ghost" type="button" data-current>Current Data</button>
              </div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Price -->
        <section id="content4">
          <div class="card">
            <h3 class="station-title">Price, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Price ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Bismarck -->
        <section id="content5">
          <div class="card">
            <h3 class="station-title">Bismarck, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Bismarck ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Schmidt -->
        <section id="content6">
          <div class="card">
            <h3 class="station-title">Schmidt, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Schmidt ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Judson -->
        <section id="content7">
          <div class="card">
            <h3 class="station-title">Judson, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Judson ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Mandan -->
        <section id="content8">
          <div class="card">
            <h3 class="station-title">Mandan, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Mandan ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Breien -->
        <section id="content9">
          <div class="card">
            <h3 class="station-title">Breien, ND</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Breien ND">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Wakpala -->
        <section id="content10">
          <div class="card">
            <h3 class="station-title">Wakpala, SD</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Wakpala SD">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Little Eagle -->
        <section id="content11">
          <div class="card">
            <h3 class="station-title">Little Eagle, SD</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Little Eagle SD">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Cash -->
        <section id="content12">
          <div class="card">
            <h3 class="station-title">Cash, SD</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Cash SD">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

        <!-- Whitehorse -->
        <section id="content13">
          <div class="card">
            <h3 class="station-title">Whitehorse, SD</h3>
            <form class="form-grid" action="/customgaugegraph/" method="POST">
              {% csrf_token %}
              <div class="field"><label class="label">Data Type</label>
                <select name="data2see" class="control" required>
                  <option value="" disabled selected>Choose Data Point</option>
                  <option>Gauge Height</option><option>Elevation</option><option>Discharge</option><option>Water Temperature</option>
                </select>
              </div>
              <div class="field"><label class="label">Start Date</label><input type="date" name="start-date" class="control" max="" required></div>
              <div class="field"><label class="label">End Date</label>  <input type="date" name="end-date"   class="control" max="" required></div>

              <div class="quick-row">
                <span class="label" style="text-transform:none;color:#475467">Quick ranges:</span>
                <button type="button" class="chip" data-range="7d">Last 7 days</button>
                <button type="button" class="chip" data-range="30d">Last 30 days</button>
                <button type="button" class="chip" data-range="ytd">YTD</button>
                <button type="button" class="chip" data-range="1y">Last 1 year</button>
                <button type="button" class="chip" data-range="clear">Clear</button>
              </div>

              <input type="hidden" name="location" value="Whitehorse SD">
              <div class="messages" aria-live="polite">
                <div class="alert error date-error"></div>
                <div class="alert info nodata-error"></div>
                <div class="alert error server-error"></div>
              </div>

              <div class="actions"><button class="btn btn-primary" type="submit">Submit</button><button class="btn btn-ghost" type="button" data-current>Current Data</button></div>
            </form>
          </div>
          <div class="graph-card"><div class="graph-loading">Ready.</div></div>
        </section>

      </div> <!-- /.sections -->
    </div> <!-- /.tabs -->
  </main>

  <script>
    // ---------- helpers ----------
    const today = new Date(); today.setHours(0,0,0,0);
    const toISO = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const norm  = v => { const d=new Date(v); d.setHours(0,0,0,0); return d; };

    // Normalize all graph placeholders across sections
document.querySelectorAll('.graph-card .graph-loading')
  .forEach(el => { el.innerHTML = 'Choose a range and press <b>Submit</b>.'; });


    // set max=today on all date inputs
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input[type="date"]').forEach(i => i.max = toISO(today));
    });

    function graphCardFor(form){ return form.closest('section').querySelector('.graph-card'); }

    function renderToGraph(card, html){
      card.innerHTML = '';
      const srcdoc = html.includes('<base') ? html : html.replace('<head>', `<head><base href="${window.location.origin}/">`);
      const iframe = document.createElement('iframe');
      iframe.className = 'graph-frame'; iframe.title = 'Graph'; iframe.srcdoc = srcdoc;
      card.appendChild(iframe);

      function resize(){
        try{
          const d=iframe.contentDocument || iframe.contentWindow.document;
          const h=Math.max(d.body.scrollHeight, d.documentElement.scrollHeight, d.body.offsetHeight, d.documentElement.offsetHeight);
          iframe.style.height = Math.max(600, h+18) + 'px';
        }catch(_){}
      }

      iframe.addEventListener('load', ()=>{
        const d=iframe.contentDocument || iframe.contentWindow.document;
        const style = d.createElement('style');
        style.textContent = `
          html,body{margin:0;height:100%;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#fff}
          .plot-container.plotly{width:100%!important;height:100%!important}
          .main-svg{width:100%!important}
          .gtitle{font-weight:700!important;fill:#0f172a!important}
          .xtick text,.ytick text,.legendtext{fill:#4b5563!important}
          .modebar{top:6px!important;right:6px!important}
          .logo{display:none!important}
        `;
        d.head.appendChild(style);
        resize(); setTimeout(resize, 350); setTimeout(resize, 1200);
        window.addEventListener('resize', resize);
      });
      card.scrollIntoView({behavior:'smooth',block:'nearest'});
    }

    async function probeHasData(form){
      const action=form.getAttribute('action')||window.location.pathname;
      const fd=new FormData(form); fd.append('check_only','1');
      try{
        const resp = await fetch(action,{
          method:'POST',
          body:new URLSearchParams(fd),
          credentials:'same-origin',
          headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8','X-Requested-With':'XMLHttpRequest'},
          redirect:'manual'
        });
        if(resp.status===200) return {ok:true, html:await resp.text()};
        if(resp.status>=500) return {empty:true};
        return {error:true,status:resp.status,html:await resp.text().catch(()=> '')};
      }catch(e){return {network:true};}
    }

    function attach(form){
      const start = form.querySelector('input[name="start-date"]');
      const end   = form.querySelector('input[name="end-date"]');
      const sel   = form.querySelector('select[name="data2see"]');
      const locEl = form.querySelector('input[name="location"]');

      const dateErr = form.querySelector('.date-error');
      const noData  = form.querySelector('.nodata-error');
      const srvErr  = form.querySelector('.server-error');
      const msgs=[dateErr,noData,srvErr];
      const clear = ()=> msgs.forEach(m=>{m.textContent=''; m.style.display='none';});
      const show  = (el,txt)=>{el.textContent=txt; el.style.display='flex';};

      // quick ranges
      form.querySelectorAll('.chip[data-range]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const r=btn.dataset.range;
          if(r==='clear'){ start.value=''; end.value=''; return; }
          const e=new Date(); e.setHours(0,0,0,0);
          let s=new Date(e);
          if(r==='7d') s.setDate(s.getDate()-7);
          if(r==='30d') s.setDate(s.getDate()-30);
          if(r==='1y') s.setFullYear(s.getFullYear()-1);
          if(r==='ytd') s=new Date(e.getFullYear(),0,1);
          start.value=toISO(s); end.value=toISO(e);
        });
      });

      // current data = last 30 days
      const current = form.querySelector('[data-current]');
      current?.addEventListener('click', ()=>{
        const e=new Date(); e.setHours(0,0,0,0);
        const s=new Date(e); s.setMonth(s.getMonth()-1);
        start.value=toISO(s); end.value=toISO(e);
        if(!sel.value){ const first=[...sel.options].find(o=>!o.disabled&&o.value); if(first) sel.value=first.value; }
        form.requestSubmit();
      });

      function valid(){
        clear();
        if(!start.value||!end.value) return false;
        const s=norm(start.value), e=norm(end.value);
        if(s>today){ show(dateErr,'⚠️ Start date cannot be in the future.'); return false; }
        if(e>today){ show(dateErr,'⚠️ End date cannot be in the future.');   return false; }
        if(s>e){     show(dateErr,'⚠️ Start date must be earlier than end date.'); return false; }
        return true;
      }

      form.addEventListener('submit', async (ev)=>{
        if(!form.checkValidity()) return;
        if(!valid()){ ev.preventDefault(); return; }
        ev.preventDefault();

        const card=graphCardFor(form);
        card.innerHTML='<div class="graph-loading">Generating graph…</div>';

        const res=await probeHasData(form);
        clear();

        if(res?.ok && res.html){ renderToGraph(card,res.html); return; }
        if(res?.empty){
          card.innerHTML='';
          const loc=(locEl?.value||'').replace(/\s+(ND|SD)$/i,'');
          show(noData, `ℹ️ No data for "${sel.value}" at ${loc} in that date range.`);
          return;
        }
        if(res?.network){ card.innerHTML=''; show(srvErr,'⚠️ Network error while requesting the graph.'); return; }
        if(res?.error){   card.innerHTML=''; show(srvErr,`⚠️ Error while generating the graph (${res.status||'unknown'}).`); return; }

        // Fallback
        try{
          const action=form.getAttribute('action')||window.location.pathname;
          const body=new URLSearchParams(new FormData(form));
          const r=await fetch(action,{method:'POST',body,credentials:'same-origin',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8','X-Requested-With':'XMLHttpRequest'}});
          const html=await r.text();
          if(r.status===200){ renderToGraph(card,html); }
          else{ card.innerHTML=''; show(noData,'ℹ️ No data for the selected range.'); }
        }catch(e){ card.innerHTML=''; show(srvErr,'⚠️ Network error while requesting the graph.'); }
      });
    }

    document.querySelectorAll('form[action="/customgaugegraph/"]').forEach(attach);
  </script>
</body>
</html>
